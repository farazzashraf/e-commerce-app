{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>VendorHub - Seller Dashboard</title>
        <script src="{% static 'js/admin-dashboard.js' %}" defer></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
              rel="stylesheet" />
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
        <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              navy: '#111827',
              'navy-light': '#1f2937',
              accent: '#a855f7',
              'accent-secondary': '#14b8a6',
              'text-primary': '#f9fafb',
              'text-secondary': '#d1d5db',
              border: '#374151'
            },
            fontFamily: {
              inter: ['Inter', 'sans-serif']
            }
          }
        }
      }
        </script>
        <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      @media (max-width: 768px) {
        .mobile-menu {
          transform: translateX(-100%);
          transition: transform 0.3s ease-in-out;
        }
        .mobile-menu.open {
          transform: translateX(0);
        }
      }
        </style>
    </head>
    <body class="bg-navy text-gray-200">
        <div class="flex flex-col md:flex-row min-h-screen">
            <!-- Mobile Header -->
            <header class="md:hidden bg-navy-light p-4 flex justify-between items-center sticky top-0 z-20">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-store text-xl"></i>
                    <span class="text-lg font-bold">VendorHub</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="relative">
                        <i class="fas fa-bell text-lg"></i>
                        {% if attention_needed > 0 %}
                            <span class="absolute -top-1 -right-1 bg-red-500 rounded-full w-4 h-4 text-xs flex items-center justify-center">{{ attention_needed }}</span>
                        {% endif %}
                    </button>
                    <button id="mobileMenuBtn" class="text-lg">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </header>
            <!-- Sidebar - Hidden on mobile by default -->
            <aside class="mobile-menu fixed md:relative md:block z-30 w-64 bg-navy-light h-full md:h-auto shadow-lg">
                <div class="p-4">
                    <div class="flex items-center justify-between mb-8">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-store text-2xl"></i>
                            <span class="text-xl font-bold">VendorHub</span>
                        </div>
                        <button id="closeMobileMenuBtn" class="md:hidden text-gray-400">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <nav class="space-y-2">
                        <a href="{% url 'admin_dashboard' %}"
                           class="flex items-center space-x-3 p-3 rounded-lg bg-blue-600 bg-opacity-20 text-blue-400">
                            <i class="fas fa-chart-pie"></i>
                            <span>Dashboard</span>
                        </a>
                        <a href="{% url 'admin_products' %}"
                           class="flex items-center space-x-3 p-3 rounded-lg hover:bg-navy">
                            <i class="fas fa-box"></i>
                            <span>Products</span>
                        </a>
                        <a href="{% url 'admin_orders' %}"
                           class="flex items-center space-x-3 p-3 rounded-lg hover:bg-navy">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Orders</span>
                        </a>
                        <a href="#"
                           class="flex items-center space-x-3 p-3 rounded-lg hover:bg-navy">
                            <i class="fas fa-chart-line"></i>
                            <span>Analytics</span>
                        </a>
                    </nav>
                </div>
            </aside>
            <!-- Main Content -->
            <main class="flex-1 p-4 md:p-8 pb-16">
                <!-- Desktop Header -->
                <header class="hidden md:flex justify-between items-center mb-8">
                    <div class="flex items-center space-x-4">
                        {% if company_logo %}
                            <img src="{{ company_logo }}"
                                 alt="{{ admin.company_name }}"
                                 class="w-12 h-12 rounded-full" />
                        {% else %}
                            <img src="https://ui-avatars.com/api/?name={{ admin.company_name|urlencode }}&background=random"
                                 alt="{{ admin.company_name }}"
                                 class="w-12 h-12 rounded-full" />
                        {% endif %}
                        <div>
                            <h1 class="text-2xl font-semibold">Welcome back, {{ admin.company_name }}</h1>
                            <p class="text-gray-400">Last login: Today at{% now 'g:i A' %}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Quick Add Product Button -->
                        <a href="{% url 'add_product' %}"
                           class="flex items-center bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-colors">
                            <i class="fas fa-plus mr-2"></i>
                            <span>Quick Add</span>
                        </a>
                        <button class="relative">
                            <i class="fas fa-bell text-xl"></i>
                            {% if attention_needed > 0 %}
                                <span class="absolute -top-1 -right-1 bg-red-500 rounded-full w-4 h-4 text-xs flex items-center justify-center">{{ attention_needed }}</span>
                            {% endif %}
                        </button>
                        <button id="profileBtn" class="relative">
                            <i class="fas fa-cog text-xl"></i>
                        </button>
                    </div>
                </header>
                <!-- Mobile Welcome Section with Quick Add Button -->
                <div class="md:hidden flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-3">
                        {% if company_logo %}
                            <img src="{{ company_logo }}"
                                 alt="{{ admin.company_name }}"
                                 class="w-10 h-10 rounded-full" />
                        {% else %}
                            <img src="https://ui-avatars.com/api/?name={{ admin.company_name|urlencode }}&background=random"
                                 alt="{{ admin.company_name }}"
                                 class="w-10 h-10 rounded-full" />
                        {% endif %}
                        <div>
                            <h1 class="text-lg font-semibold">Hi, {{ admin.company_name }}</h1>
                            <p class="text-xs text-gray-400">Today at{% now 'g:i A' %}</p>
                        </div>
                    </div>
                    <!-- Mobile Quick Add Button -->
                    <a href="{% url 'add_product' %}"
                       class="flex items-center bg-green-600 hover:bg-green-700 text-white py-1 px-3 rounded-lg text-sm transition-colors">
                        <i class="fas fa-plus mr-1"></i>
                        <span>Add</span>
                    </a>
                </div>
                <!-- Stats Grid - Responsive layout -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6 md:mb-8">
                    <!-- Today's Sales -->
                    <div class="bg-navy-light p-4 md:p-6 rounded-lg">
                        <div class="flex justify-between items-start mb-2 md:mb-4">
                            <div>
                                <p class="text-sm md:text-base text-gray-400">Today's Sales</p>
                                <h3 class="text-xl md:text-2xl font-bold">₹{{ today_sales|floatformat:0 }}</h3>
                            </div>
                            {% if sales_percentage > 0 %}
                                <span class="text-green-400">+{{ sales_percentage }}%</span>
                            {% elif sales_percentage < 0 %}
                                <span class="text-red-400">{{ sales_percentage }}%</span>
                            {% else %}
                                <span class="text-gray-400">0%</span>
                            {% endif %}
                        </div>
                        <p class="text-xs md:text-sm text-gray-400">from yesterday</p>
                    </div>
                    <!-- Pending Orders -->
                    <div class="bg-navy-light p-4 md:p-6 rounded-lg">
                        <div class="flex justify-between items-start mb-2 md:mb-4">
                            <div>
                                <p class="text-sm md:text-base text-gray-400">Pending Orders</p>
                                <h3 class="text-xl md:text-2xl font-bold">{{ pending_orders }}</h3>
                            </div>
                            {% if attention_needed > 0 %}
                                <span class="text-xs md:text-sm text-yellow-400">{{ attention_needed }} need attention</span>
                            {% endif %}
                        </div>
                        <p class="text-xs md:text-sm text-gray-400">to be processed</p>
                    </div>
                    <!-- Total Earnings -->
                    <div class="bg-navy-light p-4 md:p-6 rounded-lg">
                        <div class="flex justify-between items-start mb-2 md:mb-4">
                            <div>
                                <p class="text-sm md:text-base text-gray-400">Total Earnings</p>
                                <h3 class="text-xl md:text-2xl font-bold">₹{{ monthly_earnings|floatformat:0 }}</h3>
                            </div>
                        </div>
                        <p class="text-xs md:text-sm text-gray-400">This month</p>
                    </div>
                    <!-- Store Visitors -->
                    <div class="bg-navy-light p-4 md:p-6 rounded-lg">
                        <div class="flex justify-between items-start mb-2 md:mb-4">
                            <div>
                                <p class="text-sm md:text-base text-gray-400">Store Visitors</p>
                                <h3 class="text-xl md:text-2xl font-bold">{{ visitors|floatformat:0 }}</h3>
                            </div>
                            {% if visitors_percentage > 0 %}
                                <span class="text-green-400">+{{ visitors_percentage }}%</span>
                            {% elif visitors_percentage < 0 %}
                                <span class="text-red-400">{{ visitors_percentage }}%</span>
                            {% else %}
                                <span class="text-gray-400">0%</span>
                            {% endif %}
                        </div>
                        <p class="text-xs md:text-sm text-gray-400">this week</p>
                    </div>
                </div>
                <!-- Mobile Tabs Navigation -->
                <div class="md:hidden mb-4">
                    <div class="flex overflow-x-auto space-x-4 pb-2 -mx-4 px-4 scrollbar-hide">
                        <button id="ordersTabBtn"
                                class="px-4 py-2 bg-blue-600 bg-opacity-20 text-blue-400 rounded-lg whitespace-nowrap">
                            Recent Orders
                        </button>
                        <button id="stockTabBtn"
                                class="px-4 py-2 bg-navy-light text-gray-300 rounded-lg whitespace-nowrap">
                            Low Stock
                        </button>
                        <button id="announcementsTabBtn"
                                class="px-4 py-2 bg-navy-light text-gray-300 rounded-lg whitespace-nowrap">
                            Announcements
                        </button>
                    </div>
                </div>
                <!-- Two Column Layout - Responsive for mobile -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Recent Orders -->
                    <div id="ordersTab" class="bg-navy-light p-4 md:p-6 rounded-lg">
                        <h2 class="text-lg md:text-xl font-semibold mb-4">Recent Orders</h2>
                        <div class="space-y-3 md:space-y-4">
                            {% for order in recent_orders %}
                                <div class="flex items-center justify-between p-3 md:p-4 bg-navy rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-2 h-2 bg-{{ order.status_class }}-400 rounded-full"></div>
                                        <div>
                                            <p class="font-medium text-sm md:text-base">{{ order.order_number }}</p>
                                            <p class="text-xs md:text-sm text-gray-400">
                                                {{ order.items_count }} item
                                                {% if order.items_count != 1 %}s{% endif %}
                                                • ₹{{ order.total_price }}
                                            </p>
                                        </div>
                                    </div>
                                    <span class="text-xs md:text-sm text-{{ order.status_class }}-400">{{ order.status }}</span>
                                </div>
                            {% empty %}
                                <div class="p-3 md:p-4 bg-navy rounded-lg text-gray-400 text-sm">No recent orders</div>
                            {% endfor %}
                            {% if recent_orders %}
                                <a href="{% url 'admin_orders' %}"
                                   class="block text-center text-blue-400 hover:text-blue-300 mt-4 text-sm md:text-base">View all orders</a>
                            {% endif %}
                        </div>
                    </div>
                    <!-- Low Stock Alerts -->
                    <div id="stockTab"
                         class="bg-navy-light p-4 md:p-6 rounded-lg hidden md:block">
                        <h2 class="text-lg md:text-xl font-semibold mb-4">Low Stock Alerts</h2>
                        <div class="space-y-3 md:space-y-4">
                            {% for product in low_stock_products %}
                                <div class="flex items-center justify-between p-3 md:p-4 bg-navy rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <i class="fas fa-exclamation-triangle text-yellow-400 text-sm md:text-base"></i>
                                        <div>
                                            <p class="font-medium text-sm md:text-base">{{ product.name }}</p>
                                            <p class="text-xs md:text-sm text-gray-400">
                                                Only {{ product.stock }} units
                                                {% if product.stock != 1 %}{% endif %}
                                                left
                                            </p>
                                        </div>
                                    </div>
                                    <!-- Restock Button: triggers modal overlay -->
                                    <button type="button"
                                            class="px-3 py-1 md:px-4 md:py-2 bg-blue-500 text-white rounded-lg text-xs md:text-sm hover:bg-blue-600 restock-btn"
                                            data-product-id="{{ product.id }}"
                                            data-product-name="{{ product.name }}">Restock</button>
                                    {% comment %} <a href=""
    class="px-3 py-1 md:px-4 md:py-2 bg-blue-500 text-white rounded-lg text-xs md:text-sm hover:bg-blue-600">Restock</a> {% endcomment %}
                                </div>
                            {% empty %}
                                <div class="p-3 md:p-4 bg-navy rounded-lg text-gray-400 text-sm">All products are well-stocked</div>
                            {% endfor %}
                            {% if low_stock_products %}
                                <a href="{% url 'admin_products' %}"
                                   class="block text-center text-blue-400 hover:text-blue-300 mt-4 text-sm md:text-base">Manage inventory</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <!-- Announcements -->
                <div id="announcementsTab"
                     class="bg-navy-light p-4 md:p-6 rounded-lg hidden md:block">
                    <h2 class="text-lg md:text-xl font-semibold mb-4">Announcements</h2>
                    <div class="space-y-3 md:space-y-4">
                        {% for announcement in announcements %}
                            <div class="p-3 md:p-4 bg-navy rounded-lg">
                                <div class="flex items-center space-x-3 mb-2">
                                    <i class="fas fa-{{ announcement.icon }} text-{{ announcement.icon_class }} text-sm md:text-base"></i>
                                    <h3 class="font-medium text-sm md:text-base">{{ announcement.title }}</h3>
                                </div>
                                <p class="text-xs md:text-sm text-gray-400">{{ announcement.message }}</p>
                            </div>
                        {% empty %}
                            <div class="p-3 md:p-4 bg-navy rounded-lg text-gray-400 text-sm">No announcements at this time</div>
                        {% endfor %}
                    </div>
                </div>
            </main>
            <!-- Mobile Bottom Navigation -->
            <nav class="md:hidden fixed bottom-0 left-0 w-full bg-navy-light z-20 flex justify-around py-3 border-t border-gray-800">
                <a href="{% url 'admin_dashboard' %}"
                   class="flex flex-col items-center text-blue-400">
                    <i class="fas fa-chart-pie text-lg"></i>
                    <span class="text-xs mt-1">Dashboard</span>
                </a>
                <a href="{% url 'admin_products' %}"
                   class="flex flex-col items-center text-gray-400">
                    <i class="fas fa-box text-lg"></i>
                    <span class="text-xs mt-1">Products</span>
                </a>
                <a href="{% url 'admin_orders' %}"
                   class="flex flex-col items-center text-gray-400">
                    <i class="fas fa-shopping-cart text-lg"></i>
                    <span class="text-xs mt-1">Orders</span>
                </a>
                <button id="mobileProfileBtn"
                        class="flex flex-col items-center text-gray-400">
                    <i class="fas fa-user text-lg"></i>
                    <span class="text-xs mt-1">Profile</span>
                </button>
            </nav>
            <!-- Profile Overlay -->
            <div id="profileOverlay"
                 class="fixed inset-0 bg-black bg-opacity-50 hidden z-40">
                <div class="absolute right-0 top-0 h-full w-full sm:w-80 bg-navy-light p-6 shadow-lg overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold">Profile Settings</h2>
                        <button id="closeProfileBtn" class="text-gray-400 hover:text-white">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="space-y-6">
                        <div class="flex items-center space-x-4">
                            {% if company_logo %}
                                <img src="{{ company_logo }}"
                                     alt="{{ admin.company_name }}"
                                     class="w-16 h-16 rounded-full" />
                            {% else %}
                                <img src="https://ui-avatars.com/api/?name={{ admin.company_name|urlencode }}&background=random"
                                     alt="{{ admin.company_name }}"
                                     class="w-16 h-16 rounded-full" />
                            {% endif %}
                            <div>
                                <h3 class="font-semibold">{{ admin.company_name }}</h3>
                                <p class="text-sm text-gray-400">{{ admin.shop_address }}</p>
                            </div>
                        </div>
                        <div class="space-y-2 md:space-y-4">
                            <a href=""
                               class="flex items-center space-x-3 p-3 rounded-lg hover:bg-navy">
                                <i class="fas fa-user"></i>
                                <span>Edit Profile</span>
                            </a>
                            <a href=""
                               class="flex items-center space-x-3 p-3 rounded-lg hover:bg-navy">
                                <i class="fas fa-store"></i>
                                <span>Shop Settings</span>
                            </a>
                            <a href=""
                               class="flex items-center space-x-3 p-3 rounded-lg hover:bg-navy">
                                <i class="fas fa-bell"></i>
                                <span>Notifications</span>
                            </a>
                            <a href=""
                               class="flex items-center space-x-3 p-3 rounded-lg hover:bg-navy">
                                <i class="fas fa-lock"></i>
                                <span>Security</span>
                            </a>
                            <a href=""
                               class="flex items-center space-x-3 p-3 rounded-lg hover:bg-navy">
                                <i class="fas fa-question-circle"></i>
                                <span>Help & Support</span>
                            </a>
                            <hr class="border-gray-700" />
                            <a href="{% url 'admin_logout' %}"
                               class="flex items-center space-x-3 p-3 rounded-lg hover:bg-navy text-red-400">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Logout</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Restock Modal Overlay -->
            <div id="restockModal"
                 class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
                <div class="bg-navy-light p-6 rounded-lg w-11/12 md:w-1/3">
                    <h2 class="text-xl font-semibold mb-4" id="restockModalTitle">Restock Product</h2>
                    <form id="restockForm" action="{% url 'restock_product' %}" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="product_id" id="restockProductId" value="" />
                        <div class="mb-4">
                            <label for="restockQuantity" class="block text-sm font-medium mb-1">Quantity to Add</label>
                            <input type="number"
                                   id="restockQuantity"
                                   name="quantity"
                                   min="1"
                                   required
                                   class="w-full border border-gray-400 p-2 rounded" />
                        </div>
                        <div class="flex justify-end space-x-4">
                            <button type="button"
                                    id="cancelRestockBtn"
                                    class="px-4 py-2 bg-gray-500 text-white rounded">Cancel</button>
                            <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded">Restock</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </body>
</html>
